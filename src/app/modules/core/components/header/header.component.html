<nav class="navbar navbar-expand-lg navbar-light custom-navbar sticky-top">
  <div class="container">
    <a class="navbar-brand" href="#">Ethereal Charm</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" aria-current="page" routerLink="" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Strona główna</a>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="productsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Produkty
          </a>
          <ul class="dropdown-menu" aria-labelledby="productsDropdown">
            <li>
              <a class="dropdown-item" [routerLink]="['/products']" [queryParams]="{ page: 1, limit: 5, sort_by: 'priority', sort: 'desc' }">
                Wszystkie
              </a>
            </li>
            <li><hr class="dropdown-divider" /></li>

            <ng-container *ngIf="categories$ | async as categories">
              <ng-container *ngFor="let category of categories; let last = last">
                <li>
                  <a class="dropdown-item" (click)="navigateToCategory(category)">
                    {{ category.name }}
                  </a>
                </li>
                <li *ngIf="!last">
                  <hr class="dropdown-divider" />
                </li>
              </ng-container>
            </ng-container>
          </ul>
        </li>


        <li class="nav-item">
          <a class="nav-link" routerLink="/about" routerLinkActive="active">O nas</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" routerLink="/contact" routerLinkActive="active">Kontakt</a>
        </li>
      </ul>

      <ul class="navbar-nav">
        <!-- Cart Icon -->
        <li class="nav-item">
          <a class="nav-link display-initial cart-icon" routerLink="/cart">
            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-shopping-bag"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6.331 8h11.339a2 2 0 0 1 1.977 2.304l-1.255 8.152a3 3 0 0 1 -2.966 2.544h-6.852a3 3 0 0 1 -2.965 -2.544l-1.255 -8.152a2 2 0 0 1 1.977 -2.304z" /><path d="M9 11v-5a3 3 0 0 1 6 0v5" /></svg>
          </a>
        </li>

        <!-- Favourites Icon -->
        <li class="nav-item">
          <a class="nav-link display-initial cart-icon" [routerLink]="(user$ | async) ? '/account/favourites' : '/login'">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-heart"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path
                d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572"
              />
            </svg>
          </a>
        </li>

        <ng-container *ngIf="user$ | async as user; else notLoggedIn">
          <!-- User Icon Dropdown -->
          <li class="nav-item dropdown">
          <a class="nav-link display-initial user-icon" id="accountLink" data-bs-toggle="dropdown" aria-expanded="false">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-user"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
              <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
            </svg>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountLink">
            <li>
              <a class="dropdown-item" routerLink="/account/profile">Profil</a>
            </li>
            <li>
              <a class="dropdown-item" routerLink="/account/orders">Zamówienia</a>
            </li>
            <li>
              <a class="dropdown-item" routerLink="/account/favourites">Ulubione</a>
            </li>
            <li>
              <a class="dropdown-item" routerLink="/account/settings">Ustawienia</a>
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>
            <li>
              <button class="dropdown-item" (click)="logout()">Wyloguj się</button>
            </li>
          </ul>
          </li>


          <!-- Admin Icon -->
          <li class="nav-item" *ngIf="isAdmin(user.role)">
            <a class="nav-link display-initial user-icon" routerLink="/admin/panel" title="Panel administracyjny">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-device-desktop-analytics"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M3 4m0 1a1 1 0 0 1 1 -1h16a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1z" />
                <path d="M7 20h10" />
                <path d="M9 16v4" />
                <path d="M15 16v4" />
                <path d="M9 12v-4" />
                <path d="M12 12v-1" />
                <path d="M15 12v-2" />
                <path d="M12 12v-1" />
              </svg>
            </a>
          </li>
        </ng-container>

        <ng-template #notLoggedIn>
          <li class="nav-item">
            <a class="nav-link display-initial user-icon" routerLink="/login">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-user"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
              </svg>
            </a>
          </li>
        </ng-template>
      </ul>
    </div>
  </div>
</nav>
